{% extends 'users_base.html' %}
{% load i18n %}

{% block breadcrumb %}
    <li class="flex items-center">
        <a href="{% url 'landing_page' %}" class="text-primary-blue dark:text-accent-light hover:text-accent-blue dark:hover:text-text-dark transition-colors duration-200">{% trans "Home" %}</a>
        <i class="fas fa-chevron-right h-3 w-3 text-text-light-secondary dark:text-text-dark-secondary mx-2"></i>
    </li>
    <li class="flex items-center">
        <a href="{% url 'profile' %}" class="text-primary-blue dark:text-accent-light hover:text-accent-blue dark:hover:text-text-dark transition-colors duration-200">{% trans "Profile" %}</a>
    </li>
{% endblock %}

{% block content %}
<div class="min-h-screen sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <div class="lg:col-span-1">
                {% include 'users/profile/sidebar.html' %}
            </div>

            <!-- Content Area -->
            <div class="lg:col-span-3">
                <div id="content-overview" class="tab-content animate-fadeIn">
                    {% include 'users/profile/overview.html' %}
                </div>
                <div id="content-personal-info" class="tab-content hidden animate-fadeIn">
                    {% include 'users/profile/personal_info.html' %}
                </div>
                <div id="content-projects" class="tab-content hidden animate-fadeIn">
                    {% include 'users/profile/projects.html' %}
                </div>
                <div id="content-certificates" class="tab-content hidden animate-fadeIn">
                    {% include 'users/profile/certificates.html' %}
                </div>
                <div id="content-account-management" class="tab-content hidden animate-fadeIn">
                    {% include 'users/profile/account_management.html' %}
                </div>
                <div id="content-edit-profile" class="tab-content hidden animate-fadeIn">
                    {% include 'users/profile/edit_profile.html' %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function switchTab(tabName) {
        // Hide all tab contents
        const contents = document.querySelectorAll('.tab-content');
        contents.forEach(content => {
            content.classList.add('hidden');
        });

        // Show selected tab content
        const selectedContent = document.getElementById('content-' + tabName);
        if (selectedContent) {
            selectedContent.classList.remove('hidden');
            // Re-trigger animation
            selectedContent.classList.remove('animate-fadeIn');
            void selectedContent.offsetWidth; // trigger reflow
            selectedContent.classList.add('animate-fadeIn');
        }

        // Update active button state
        const buttons = document.querySelectorAll('[id^="tab-"]');
        buttons.forEach(button => {
            // Reset to inactive state
            button.classList.remove('bg-primary-blue', 'text-white', 'shadow-md');
            button.classList.add('text-text-light', 'dark:text-text-dark', 'hover:bg-light-bg', 'dark:hover:bg-dark-bg', 'hover:text-primary-blue');
        });

        // Set active state for clicked button
        const activeButton = document.getElementById('tab-' + tabName);
        if (activeButton) {
            activeButton.classList.remove('text-text-light', 'dark:text-text-dark', 'hover:bg-light-bg', 'dark:hover:bg-dark-bg', 'hover:text-primary-blue');
            activeButton.classList.add('bg-primary-blue', 'text-white', 'shadow-md');
        }
        
        // Save preference
        localStorage.setItem('activeProfileTab', tabName);
    }

    // Check for saved tab or default to overview
    document.addEventListener('DOMContentLoaded', () => {
        const savedTab = localStorage.getItem('activeProfileTab');
        if (savedTab) {
            switchTab(savedTab);
        } else {
            // Ensure default state is consistent
            switchTab('overview');
        }
    });
</script>
{% endblock %}
