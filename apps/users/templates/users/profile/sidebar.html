{% load i18n %}
<div class="bg-light-secondary-bg dark:bg-dark-secondary-bg rounded-2xl shadow-lg p-6 animate-fadeIn border border-border-light dark:border-border-dark sticky top-24">
    <!-- Mobile Toggle Header -->
    <div class="lg:hidden flex justify-between items-center cursor-pointer mb-0" onclick="toggleSidebar()">
        <span class="text-sm font-semibold text-text-light dark:text-text-dark">{% trans "Menu" %}</span>
        <button class="text-text-light dark:text-text-dark focus:outline-none transition-all duration-300 ease-in-out transform" id="sidebar-toggle-icon">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- Collapsible Content -->
    <div id="sidebar-content" class="hidden lg:block transition-all duration-500 ease-in-out overflow-hidden" style="max-height: 0px;">
        <nav class="space-y-2 mb-8">
            <button onclick="switchTab('overview')" id="tab-overview" class="w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 bg-primary-blue text-white shadow-md group">
                <i class="fas fa-tachometer-alt w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">{% trans "Dashboard" %}</span>
            </button>
            <button onclick="switchTab('personal-info')" id="tab-personal-info" class="w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-text-light dark:text-text-dark hover:bg-light-bg dark:hover:bg-dark-bg hover:text-primary-blue group">
                <i class="fas fa-user w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">{% trans "Personal Info" %}</span>
            </button>
            <button onclick="switchTab('projects')" id="tab-projects" class="w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-text-light dark:text-text-dark hover:bg-light-bg dark:hover:bg-dark-bg hover:text-primary-blue group">
                <i class="fas fa-project-diagram w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">{% trans "My Projects" %}</span>
            </button>
            <button onclick="switchTab('certificates')" id="tab-certificates" class="w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-text-light dark:text-text-dark hover:bg-light-bg dark:hover:bg-dark-bg hover:text-primary-blue group">
                <i class="fas fa-award w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">{% trans "Certificates" %}</span>
            </button>
            <button onclick="switchTab('account-management')" id="tab-account-management" class="w-full flex items-center px-4 py-3 rounded-xl transition-all duration-200 text-text-light dark:text-text-dark hover:bg-light-bg dark:hover:bg-dark-bg hover:text-primary-blue group">
                <i class="fas fa-cog w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium">{% trans "Account" %}</span>
            </button>
        </nav>

        <div class="border-t border-border-light dark:border-border-dark pt-6">
            <h3 class="text-xs font-semibold text-text-light-secondary dark:text-text-dark-secondary uppercase tracking-wider mb-4 px-2">{% trans "Quick Actions" %}</h3>
            <div class="space-y-3">
                <button onclick="switchTab('edit-profile')" class="w-full flex items-center px-4 py-2 rounded-xl text-sm font-medium text-text-light dark:text-text-dark hover:bg-light-bg dark:hover:bg-dark-bg transition-colors group text-left">
                    <i class="fas fa-edit w-6 text-center mr-3 text-primary-blue group-hover:scale-110 transition-transform"></i>
                    {% trans "Edit Profile" %}
                </button>
                <a href="{% url 'logout' %}" class="w-full flex items-center px-4 py-2 rounded-xl text-sm font-medium text-error hover:bg-error hover:bg-opacity-10 transition-colors group">
                    <i class="fas fa-sign-out-alt w-6 text-center mr-3 group-hover:scale-110 transition-transform"></i>
                    {% trans "Logout" %}
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle sidebar with smooth max-height animation
    function toggleSidebar() {
        const content = document.getElementById('sidebar-content');
        const icon = document.querySelector('#sidebar-toggle-icon i');
        if (!content) return;

        if (content.classList.contains('hidden')) {
            // Expanding: show content and animate in
            content.classList.remove('hidden');
            const scrollHeight = content.scrollHeight;
            content.style.transition = 'max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out';
            // Force reflow to trigger animation
            void content.offsetHeight;
            content.style.maxHeight = scrollHeight + 'px';
            content.style.marginTop = '1rem';
            if (icon) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up', 'rotate-180');
            }
        } else {
            // Collapsing: animate out then hide
            content.style.transition = 'max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out';
            content.style.maxHeight = '0px';
            content.style.marginTop = '0';
            if (icon) {
                icon.classList.remove('fa-chevron-up', 'rotate-180');
                icon.classList.add('fa-chevron-down');
            }
            setTimeout(() => {
                if (content.style.maxHeight === '0px') {
                    content.classList.add('hidden');
                }
            }, 500);
        }
    }

    // Track previous breakpoint state
    let prevIsDesktop = window.innerWidth >= 1024;

    // Initialize sidebar state based on viewport
    function initSidebarResponsive() {
        const content = document.getElementById('sidebar-content');
        const icon = document.querySelector('#sidebar-toggle-icon i');
        if (!content) return;

        if (window.innerWidth >= 1024) {
            // Desktop: always show full menu
            content.classList.remove('hidden');
            content.style.maxHeight = 'none';
            content.style.marginTop = '';
            content.style.transition = '';
            if (icon) {
                icon.classList.remove('fa-chevron-up', 'rotate-180');
                icon.classList.add('fa-chevron-down');
            }
        } else {
            // Mobile: collapsed by default
            content.classList.add('hidden');
            content.style.maxHeight = '0px';
            content.style.marginTop = '0';
            content.style.transition = '';
            if (icon) {
                icon.classList.remove('fa-chevron-up', 'rotate-180');
                icon.classList.add('fa-chevron-down');
            }
        }
        prevIsDesktop = window.innerWidth >= 1024;
    }

    // Handle window resize to detect breakpoint crossing
    window.addEventListener('resize', () => {
        const content = document.getElementById('sidebar-content');
        const icon = document.querySelector('#sidebar-toggle-icon i');
        if (!content) return;

        const isDesktop = window.innerWidth >= 1024;

        // Desktop -> Mobile: animate collapse
        if (prevIsDesktop && !isDesktop) {
            content.style.transition = 'max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out';
            content.style.maxHeight = '0px';
            content.style.marginTop = '0';
            if (icon) {
                icon.classList.remove('fa-chevron-up', 'rotate-180');
                icon.classList.add('fa-chevron-down');
            }
            setTimeout(() => {
                if (content.style.maxHeight === '0px') {
                    content.classList.add('hidden');
                }
            }, 500);
        }

        // Mobile -> Desktop: fully expand and show
        if (!prevIsDesktop && isDesktop) {
            content.classList.remove('hidden');
            content.style.maxHeight = 'none';
            content.style.marginTop = '';
            content.style.transition = '';
            if (icon) {
                icon.classList.remove('fa-chevron-up', 'rotate-180');
                icon.classList.add('fa-chevron-down');
            }
        }

        prevIsDesktop = isDesktop;
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initSidebarResponsive);
</script>
