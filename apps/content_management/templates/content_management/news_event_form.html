{% extends "content_management_base.html" %}
{% load static %}

{% block title %}
{% if news_event.title %}
Update News/Event: {{ news_event.title }}
{% else %}
New News & Event
{% endif %}
{% endblock %}

{% block breadcrumb %}
<li class="flex items-center">
    <a href="{% url 'news_event_list' %}" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200">News & Events</a>
    <i class="fas fa-chevron-right h-5 w-5 content-center text-gray-400 dark:text-gray-500 mx-2"></i>
</li>
<li class="flex items-center">
    {% if news_event.title %}
    <span class="text-gray-500 dark:text-gray-400">{{ news_event.title }}</span>
    {% else %}
    <span class="text-gray-500 dark:text-gray-400">New News & Event</span>
    {% endif %}
</li>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- News/Event Form Header -->
    {% if news_event.title %}
    <div class="bg-gradient-to-r from-amber-600 to-orange-600 rounded-lg shadow-lg overflow-hidden mb-8">
        <div class="px-6 py-8 text-white">
            <div class="flex items-center">
                <div class="flex-shrink-0 mr-4">
                    <i class="fas fa-edit text-4xl text-amber-200 content-center"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold mb-2">Update News/Event</h1>
                    <p class="text-amber-100">{{ news_event.title|truncatechars:80 }}</p>
                    <p class="text-amber-200 text-sm mt-1">Modify existing content</p>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-lg overflow-hidden mb-8">
        <div class="px-6 py-8 text-white">
            <div class="flex items-center">
                <div class="flex-shrink-0 mr-4">
                    <i class="fas fa-newspaper text-4xl text-blue-200 content-center"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold mb-2">Create New News/Event</h1>
                    <p class="text-blue-100">Add news, events, or announcements to the platform</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="bg-card-bg-light dark:bg-card-bg-dark shadow-lg rounded-lg border border-border-light dark:border-border-dark overflow-hidden">
        <div class="px-6 py-4 bg-gray-50 dark:bg-gray-800 border-b border-border-light dark:border-border-dark">
            <h2 class="text-lg font-semibold text-text-light dark:text-text-dark flex items-center">
                <i class="fas fa-edit text-primary-blue mr-2 content-center"></i>
                {% if news_event.title %}Edit News/Event Details{% else %}News/Event Information{% endif %}
            </h2>
        </div>

        <form method="post" enctype="multipart/form-data" class="p-6 space-y-8">
            {% csrf_token %}

            <!-- Title Field -->
            <div class="space-y-2">
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-heading text-blue-600 mr-2 content-center"></i>
                    {{ form.title.label_tag }}
                    {% if form.title.field.required %}
                        <span class="text-red-500 ml-1">*</span>
                    {% endif %}
                </label>
                <input type="text" name="{{ form.title.name }}" id="{{ form.title.id_for_label }}"
                       class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                              focus:border-blue-500 focus:ring-blue-500 focus:bg-blue-50 dark:focus:bg-blue-900/20
                              dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-lg"
                       value="{% if form.title.value %}{{ form.title.value }}{% endif %}"
                       placeholder="Enter a compelling title for your news or event..."
                       {% if form.title.field.required %}required{% endif %}>
                {% if form.title.errors %}
                    <div class="mt-2">
                        {% for error in form.title.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">This will be the main headline displayed to users</p>
            </div>

            <!-- Content Type Field -->
            <div class="space-y-2">
                <label for="{{ form.content_type.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-tags text-green-600 mr-2 content-center"></i>
                    {{ form.content_type.label_tag }}
                    {% if form.content_type.field.required %}
                        <span class="text-red-500 ml-1">*</span>
                    {% endif %}
                </label>
                <select name="{{ form.content_type.name }}" id="{{ form.content_type.id_for_label }}"
                        class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                               focus:border-green-500 focus:ring-green-500 focus:bg-green-50 dark:focus:bg-green-900/20
                               dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-lg"
                        {% if form.content_type.field.required %}required{% endif %}>
                    {% for value, text in form.content_type.field.choices %}
                        <option value="{{ value }}" {% if form.content_type.value == value|stringformat:"s" %}selected{% endif %}>{{ text }}</option>
                    {% endfor %}
                </select>
                {% if form.content_type.errors %}
                    <div class="mt-2">
                        {% for error in form.content_type.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Choose the appropriate category for this content</p>
            </div>

            <!-- Publish Date Field -->
            <div class="space-y-2">
                <label for="{{ form.publish_date.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-calendar-alt text-purple-600 mr-2 content-center"></i>
                    {{ form.publish_date.label_tag }}
                    {% if form.publish_date.field.required %}
                        <span class="text-red-500 ml-1">*</span>
                    {% endif %}
                </label>
                <input type="datetime-local" name="{{ form.publish_date.name }}" id="{{ form.publish_date.id_for_label }}"
                       value="{% if form.publish_date.value %}{{ form.publish_date.value|date:'Y-m-d\\TH:i' }}{% endif %}"
                       class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                              focus:border-purple-500 focus:ring-purple-500 focus:bg-purple-50 dark:focus:bg-purple-900/20
                              dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-lg"
                       {% if form.publish_date.field.required %}required{% endif %}>
                {% if form.publish_date.errors %}
                    <div class="mt-2">
                        {% for error in form.publish_date.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">When should this content be published?</p>
            </div>

            <!-- Publication Status -->
            <div class="space-y-2">
                <label for="{{ form.is_published.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-eye text-indigo-600 mr-2 content-center"></i>
                    {{ form.is_published.label_tag }}
                </label>
                <div class="flex items-center space-x-3">
                    <input type="checkbox" name="{{ form.is_published.name }}" id="{{ form.is_published.id_for_label }}"
                           class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 dark:border-gray-600 rounded transition-all duration-200"
                           {% if form.is_published.value %}checked{% endif %}>
                    <div class="flex-1">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Make this content visible to users</span>
                        {% if form.is_published.errors %}
                            <div class="mt-1">
                                {% for error in form.is_published.errors %}
                                    <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                        <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                                    </p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Unpublished content is only visible in the admin panel</p>
                    </div>
                </div>
            </div>

            <!-- Highlight & Featured Options -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Is Hero Highlight -->
                <div class="space-y-2">
                    <label for="{{ form.is_hero_highlight.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                        <i class="fas fa-star text-yellow-600 mr-2 content-center"></i>
                        {{ form.is_hero_highlight.label_tag }}
                    </label>
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" name="{{ form.is_hero_highlight.name }}" id="{{ form.is_hero_highlight.id_for_label }}"
                               class="h-5 w-5 text-yellow-600 focus:ring-yellow-500 border-gray-300 dark:border-gray-600 rounded transition-all duration-200"
                               {% if form.is_hero_highlight.value %}checked{% endif %}>
                        <div class="flex-1">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Feature in hero carousel</span>
                            {% if form.is_hero_highlight.errors %}
                                <div class="mt-1">
                                    {% for error in form.is_hero_highlight.errors %}
                                        <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                            <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                                        </p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Display prominently in the carousel</p>
                        </div>
                    </div>
                </div>

                <!-- Is Featured -->
                <div class="space-y-2">
                    <label for="{{ form.is_featured.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                        <i class="fas fa-heart text-rose-600 mr-2 content-center"></i>
                        {{ form.is_featured.label_tag }}
                    </label>
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" name="{{ form.is_featured.name }}" id="{{ form.is_featured.id_for_label }}"
                               class="h-5 w-5 text-rose-600 focus:ring-rose-500 border-gray-300 dark:border-gray-600 rounded transition-all duration-200"
                               {% if form.is_featured.value %}checked{% endif %}>
                        <div class="flex-1">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Mark as featured content</span>
                            {% if form.is_featured.errors %}
                                <div class="mt-1">
                                    {% for error in form.is_featured.errors %}
                                        <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                            <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                                        </p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Show in featured section</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cover Image Field -->
            <div class="space-y-2">
                <label for="{{ form.cover_image.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-image text-orange-600 mr-2 content-center"></i>
                    {{ form.cover_image.label_tag }}
                </label>
                <input type="file" name="{{ form.cover_image.name }}" id="{{ form.cover_image.id_for_label }}"
                       class="block w-full px-4 py-3 text-sm text-gray-500 dark:text-gray-400
                              file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0
                              file:text-sm file:font-semibold file:bg-orange-500 file:text-white
                              hover:file:bg-orange-600 dark:file:bg-orange-600 dark:hover:file:bg-orange-500
                              cursor-pointer transition-all duration-200 border border-gray-300 dark:border-gray-600 rounded-lg">
                {% if form.cover_image.value %}
                    <div id="{{ form.cover_image.id_for_label }}_current" class="mt-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
                        <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center">
                            <i class="fas fa-check-circle text-green-500 mr-1 content-center"></i>
                            Current: <a href="{{ form.cover_image.value.url }}" target="_blank" class="text-orange-600 hover:text-orange-700 font-medium">{{ form.cover_image.value.name }}</a>
                        </p>
                    </div>
                    <button type="button" id="clear-cover-image" class="mt-2 inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-orange-700 bg-orange-100 hover:bg-orange-200 dark:bg-orange-900 dark:text-orange-300 dark:hover:bg-orange-800 transition-colors duration-200">
                        <i class="fas fa-times mr-1 content-center"></i>Clear Image
                    </button>
                    <input type="checkbox" name="{{ form.cover_image.name }}-clear" id="{{ form.cover_image.id_for_label }}_clear" style="display:none">
                {% endif %}
                {% if form.cover_image.errors %}
                    <div class="mt-2">
                        {% for error in form.cover_image.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Upload a cover image or provide a URL below</p>
            </div>

            <!-- Cover Image URL Field -->
            <div class="space-y-2">
                <label for="{{ form.cover_image_url.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-link text-teal-600 mr-2 content-center"></i>
                    {{ form.cover_image_url.label_tag }}
                </label>
                <input type="url" name="{{ form.cover_image_url.name }}" id="{{ form.cover_image_url.id_for_label }}"
                       class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                              focus:border-teal-500 focus:ring-teal-500 focus:bg-teal-50 dark:focus:bg-teal-900/20
                              dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-lg"
                       value="{% if form.cover_image_url.value %}{{ form.cover_image_url.value }}{% endif %}"
                       placeholder="https://example.com/image.jpg">
                {% if form.cover_image_url.errors %}
                    <div class="mt-2">
                        {% for error in form.cover_image_url.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Alternative to uploading: provide a direct link to an image</p>
            </div>

            <!-- External Link Field -->
            <div class="space-y-2">
                <label for="{{ form.external_link.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-external-link-alt text-pink-600 mr-2 content-center"></i>
                    {{ form.external_link.label_tag }}
                </label>
                <input type="url" name="{{ form.external_link.name }}" id="{{ form.external_link.id_for_label }}"
                       class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                              focus:border-pink-500 focus:ring-pink-500 focus:bg-pink-50 dark:focus:bg-pink-900/20
                              dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-lg"
                       value="{% if form.external_link.value %}{{ form.external_link.value }}{% endif %}"
                       placeholder="https://external-site.com/article">
                {% if form.external_link.errors %}
                    <div class="mt-2">
                        {% for error in form.external_link.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Optional: link to external content or full article</p>
            </div>

            <!-- Body Field -->
            <div class="space-y-2">
                <label for="{{ form.body.id_for_label }}" class="block text-sm font-semibold text-text-light dark:text-text-dark flex items-center">
                    <i class="fas fa-align-left text-cyan-600 mr-2 content-center"></i>
                    {{ form.body.label_tag }}
                    {% if form.body.field.required %}
                        <span class="text-red-500 ml-1">*</span>
                    {% endif %}
                </label>
                <textarea name="{{ form.body.name }}" id="{{ form.body.id_for_label }}" rows="10"
                          class="block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm
                                 focus:border-cyan-500 focus:ring-cyan-500 focus:bg-cyan-50 dark:focus:bg-cyan-900/20
                                 dark:bg-gray-800 dark:text-gray-200 transition-all duration-200 text-base leading-relaxed"
                          placeholder="Write your news content, event details, or announcement here..."
                          {% if form.body.field.required %}required{% endif %}>{% if form.body.value %}{{ form.body.value }}{% endif %}</textarea>
                {% if form.body.errors %}
                    <div class="mt-2">
                        {% for error in form.body.errors %}
                            <p class="text-sm text-red-600 dark:text-red-400 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-1 content-center"></i>{{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Provide detailed content for your news or event</p>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-border-light dark:border-border-dark">
                <a href="{% url 'news_event_list' %}" class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-lg shadow-sm text-text-light dark:text-text-dark bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-arrow-left mr-2 content-center"></i>
                    Cancel
                </a>
                <button type="submit" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-save mr-2 content-center"></i>
                    {% if news_event.title %}Update News/Event{% else %}Create News/Event{% endif %}
                </button>
            </div>
        </form>
    </div>

    <!-- Help Section -->
    <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 content-center"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">Content Creation Tips</h3>
                <div class="mt-2 text-sm text-blue-700 dark:text-blue-300">
                    <ul class="list-disc list-inside space-y-1">
                        <li>Use compelling titles that clearly indicate the content type</li>
                        <li>Set appropriate publish dates for timely content</li>
                        <li>Add cover images to increase engagement</li>
                        <li>Provide external links for additional resources</li>
                        <li>Write clear, engaging content that serves your audience</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const coverImageInput = document.getElementById('{{ form.cover_image.id_for_label }}');
        const coverImageUrlInput = document.getElementById('{{ form.cover_image_url.id_for_label }}');

        // Ensure only one of the fields is filled
        coverImageInput.addEventListener('change', function() {
            if (coverImageInput.value) {
                coverImageUrlInput.value = '';
            }
        });

        coverImageUrlInput.addEventListener('input', function() {
            if (coverImageUrlInput.value) {
                coverImageInput.value = '';
            }
        });

        // Clear uploaded cover image (if present)
        const clearCoverBtn = document.getElementById('clear-cover-image');
        if (clearCoverBtn) {
            clearCoverBtn.addEventListener('click', function() {
                if (coverImageInput) coverImageInput.value = '';
                const clearCheckbox = document.getElementById('{{ form.cover_image.id_for_label }}_clear');
                if (clearCheckbox) clearCheckbox.checked = true;
                clearCoverBtn.style.display = 'none';
            });
        }
    });
</script>
{% endblock %}
